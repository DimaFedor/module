{"version":3,"sources":["../electron/main.ts","../electron/utils/paths.ts"],"sourcesContent":["import { app, BrowserWindow, dialog, ipcMain, nativeTheme } from 'electron';\nimport path from 'path';\nimport fs from 'fs';\nimport crypto from 'crypto';\nimport BetterSqlite3 from 'better-sqlite3';\nimport type { Database } from 'better-sqlite3';\nimport PDFDocument from 'pdfkit';\nimport archiver from 'archiver';\nimport { resolveFontPath } from './utils/paths';\n\nconst isDev = !app.isPackaged;\n\nlet mainWindow: BrowserWindow | null = null;\nlet db: Database;\n\ntype EvidenceStatus = 'draft' | 'submitted' | 'approved';\n\ninterface EvidenceRow {\n  id: string;\n  title: string;\n  description: string | null;\n  category: string;\n  status: EvidenceStatus;\n  file_path: string;\n  version_group_id: string;\n  version_number: number;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface EvidenceListRequest {\n  search?: string;\n  status?: EvidenceStatus | 'all';\n  category?: string | 'all';\n  sortBy?: 'created_at' | 'status';\n  sortDir?: 'asc' | 'desc';\n  page?: number;\n  pageSize?: number;\n  includeHistory?: boolean;\n}\n\ninterface EvidenceCreatePayload {\n  title: string;\n  description?: string;\n  category: string;\n  status: EvidenceStatus;\n  file_path: string;\n  tags: string[];\n}\n\ninterface EvidenceUpdatePayload {\n  title: string;\n  description?: string;\n  category: string;\n  status: EvidenceStatus;\n  file_path?: string | null;\n  tags: string[];\n}\n\ninterface AuditLogRow {\n  id: string;\n  action_type: string;\n  entity_id: string;\n  entity_type: string;\n  actor: string;\n  timestamp: string;\n}\n\ninterface ExportFilters {\n  status?: EvidenceStatus | 'all';\n  category?: string | 'all';\n}\n\nlet lastDeleted:\n  | {\n      evidence: EvidenceRow;\n      tags: string[];\n      deletedAt: number;\n    }\n  | null = null;\n\nfunction getPaths() {\n  const userData = app.getPath('userData');\n  const dbPath = path.join(userData, 'vault.db');\n  const evidenceDir = path.join(userData, 'evidence-files');\n  return { userData, dbPath, evidenceDir };\n}\n\nfunction ensureDatabase() {\n  const { dbPath } = getPaths();\n  fs.mkdirSync(path.dirname(dbPath), { recursive: true });\n  db = new BetterSqlite3(dbPath);\n\n  const schemaPath = path.join(__dirname, '..', 'database', 'schema.sql');\n  const schemaSql = fs.readFileSync(schemaPath, 'utf-8');\n  db.exec(schemaSql);\n}\n\nfunction createWindow() {\n  const preloadPath = path.join(__dirname, 'preload.js');\n\n  mainWindow = new BrowserWindow({\n    width: 1280,\n    height: 800,\n    webPreferences: {\n      preload: preloadPath,\n      contextIsolation: true,\n      nodeIntegration: false,\n    },\n    show: false,\n  });\n\n  mainWindow.once('ready-to-show', () => {\n    mainWindow?.show();\n  });\n\n  if (isDev) {\n    mainWindow.loadURL('http://localhost:5173');\n  } else {\n    const indexPath = path.join(__dirname, '..', 'renderer-dist', 'index.html');\n    mainWindow.loadFile(indexPath);\n  }\n}\n\nfunction registerIpcHandlers() {\n  const { evidenceDir } = getPaths();\n  fs.mkdirSync(evidenceDir, { recursive: true });\n  const fontPath = resolveFontPath();\n\n  ipcMain.handle('theme:get-system', () => {\n    return nativeTheme.shouldUseDarkColors ? 'dark' : 'light';\n  });\n\n  ipcMain.handle('evidence:openFile', async () => {\n    if (!mainWindow) return null;\n    const result = await dialog.showOpenDialog(mainWindow, {\n      title: 'Select evidence file',\n      properties: ['openFile'],\n    });\n    if (result.canceled || !result.filePaths[0]) {\n      return null;\n    }\n    const source = result.filePaths[0];\n    const fileName = `${Date.now()}-${path.basename(source)}`;\n    const dest = path.join(evidenceDir, fileName);\n    fs.copyFileSync(source, dest);\n    return dest;\n  });\n\n  ipcMain.handle('evidence:list', (_event, req: EvidenceListRequest) => {\n    const {\n      search = '',\n      status = 'all',\n      category = 'all',\n      sortBy = 'created_at',\n      sortDir = 'desc',\n      page = 1,\n      pageSize = 10,\n      includeHistory = false,\n    } = req || {};\n\n    const where: string[] = [];\n    const params: any[] = [];\n\n    if (search) {\n      where.push('(title LIKE ? OR description LIKE ? OR id IN (SELECT evidence_id FROM evidence_tags et JOIN tags t ON et.tag_id = t.id WHERE t.name LIKE ?))');\n      const like = `%${search}%`;\n      params.push(like, like, like);\n    }\n    if (status !== 'all') {\n      where.push('status = ?');\n      params.push(status);\n    }\n    if (category !== 'all') {\n      where.push('category = ?');\n      params.push(category);\n    }\n\n    const whereSql = where.length ? `WHERE ${where.join(' AND ')}` : '';\n\n    const baseTable = includeHistory\n      ? 'evidence'\n      : 'evidence e JOIN (SELECT version_group_id, MAX(version_number) AS max_version FROM evidence GROUP BY version_group_id) latest ON e.version_group_id = latest.version_group_id AND e.version_number = latest.max_version';\n\n    const totalStmt = db.prepare(`SELECT COUNT(*) as count FROM ${baseTable} ${whereSql}`);\n    const totalRow = totalStmt.get(...params) as { count: number };\n\n    const offset = (page - 1) * pageSize;\n    const orderByColumn = sortBy === 'status' ? 'status' : 'created_at';\n    const rowsStmt = db.prepare(\n      `SELECT * FROM ${baseTable} ${whereSql} ORDER BY ${orderByColumn} ${sortDir.toUpperCase()} LIMIT ? OFFSET ?`\n    );\n    const items = rowsStmt.all(...params, pageSize, offset) as EvidenceRow[];\n\n    return { items, total: totalRow.count };\n  });\n\n  ipcMain.handle('evidence:get', (_event, id: string) => {\n    const stmt = db.prepare('SELECT * FROM evidence WHERE id = ?');\n    const row = stmt.get(id) as EvidenceRow | undefined;\n    if (!row) return null;\n\n    const tagsStmt = db.prepare(\n      'SELECT t.name FROM tags t JOIN evidence_tags et ON et.tag_id = t.id WHERE et.evidence_id = ?'\n    );\n    const tags = tagsStmt.all(id).map((t: any) => t.name) as string[];\n    return { ...row, tags };\n  });\n\n  ipcMain.handle('evidence:create', (_event, payload: EvidenceCreatePayload) => {\n    const id = crypto.randomUUID();\n    const versionGroupId = crypto.randomUUID();\n    const now = new Date().toISOString();\n\n    const insert = db.prepare(\n      `INSERT INTO evidence (id, title, description, category, status, file_path, version_group_id, version_number, created_at, updated_at)\n       VALUES (@id, @title, @description, @category, @status, @file_path, @version_group_id, @version_number, @created_at, @updated_at)`\n    );\n    const evidence: EvidenceRow = {\n      id,\n      title: payload.title,\n      description: payload.description ?? null,\n      category: payload.category,\n      status: payload.status,\n      file_path: payload.file_path,\n      version_group_id: versionGroupId,\n      version_number: 1,\n      created_at: now,\n      updated_at: now,\n    };\n    insert.run(evidence);\n\n    upsertTagsForEvidence(id, payload.tags);\n\n    logAudit('CREATE', id, 'evidence');\n\n    return evidence;\n  });\n\n  ipcMain.handle('evidence:update', (_event, id: string, payload: EvidenceUpdatePayload) => {\n    const existingStmt = db.prepare('SELECT * FROM evidence WHERE id = ?');\n    const existing = existingStmt.get(id) as EvidenceRow | undefined;\n    if (!existing) return null;\n\n    const now = new Date().toISOString();\n    const maxVersionStmt = db.prepare('SELECT MAX(version_number) as maxVersion FROM evidence WHERE version_group_id = ?');\n    const maxVersionRow = maxVersionStmt.get(existing.version_group_id) as { maxVersion: number };\n    const nextVersion = (maxVersionRow?.maxVersion ?? existing.version_number) + 1;\n\n    const newId = crypto.randomUUID();\n    const insert = db.prepare(\n      `INSERT INTO evidence (id, title, description, category, status, file_path, version_group_id, version_number, created_at, updated_at)\n       VALUES (@id, @title, @description, @category, @status, @file_path, @version_group_id, @version_number, @created_at, @updated_at)`\n    );\n\n    const evidence: EvidenceRow = {\n      id: newId,\n      title: payload.title,\n      description: payload.description ?? null,\n      category: payload.category,\n      status: payload.status,\n      file_path: payload.file_path ?? existing.file_path,\n      version_group_id: existing.version_group_id,\n      version_number: nextVersion,\n      created_at: existing.created_at,\n      updated_at: now,\n    };\n\n    insert.run(evidence);\n    upsertTagsForEvidence(newId, payload.tags);\n\n    if (existing.status !== payload.status) {\n      logAudit('STATUS_CHANGE', newId, 'evidence');\n    }\n\n    return evidence;\n  });\n\n  ipcMain.handle('evidence:delete', (_event, id: string) => {\n    const select = db.prepare('SELECT * FROM evidence WHERE id = ?');\n    const row = select.get(id) as EvidenceRow | undefined;\n    if (!row) return false;\n\n    const tagsStmt = db.prepare(\n      'SELECT t.name FROM tags t JOIN evidence_tags et ON et.tag_id = t.id WHERE et.evidence_id = ?'\n    );\n    const tags = tagsStmt.all(id).map((t: any) => t.name) as string[];\n\n    const delTags = db.prepare('DELETE FROM evidence_tags WHERE evidence_id = ?');\n    const delEvidence = db.prepare('DELETE FROM evidence WHERE id = ?');\n\n    const now = Date.now();\n    db.transaction(() => {\n      delTags.run(id);\n      delEvidence.run(id);\n      lastDeleted = { evidence: row, tags, deletedAt: now };\n    })();\n\n    logAudit('DELETE', id, 'evidence');\n\n    return true;\n  });\n\n  ipcMain.handle('evidence:undoDelete', () => {\n    if (!lastDeleted) return null;\n    const age = Date.now() - lastDeleted.deletedAt;\n    if (age > 5000) {\n      lastDeleted = null;\n      return null;\n    }\n\n    const insert = db.prepare(\n      `INSERT INTO evidence (id, title, description, category, status, file_path, version_group_id, version_number, created_at, updated_at)\n       VALUES (@id, @title, @description, @category, @status, @file_path, @version_group_id, @version_number, @created_at, @updated_at)`\n    );\n    const evidence = lastDeleted.evidence;\n    db.transaction(() => {\n      insert.run(evidence);\n      upsertTagsForEvidence(evidence.id, lastDeleted!.tags);\n    })();\n\n    lastDeleted = null;\n    return evidence;\n  });\n\n  ipcMain.handle('audit:list', () => {\n    const stmt = db.prepare(\n      'SELECT * FROM audit_log ORDER BY timestamp DESC LIMIT 500'\n    );\n    const rows = stmt.all() as AuditLogRow[];\n    return rows;\n  });\n\n  ipcMain.handle('export:create', async (_event, filters: ExportFilters) => {\n    if (!mainWindow) return null;\n\n    const result = await dialog.showSaveDialog(mainWindow, {\n      title: 'Save export package',\n      filters: [{ name: 'Zip Archive', extensions: ['zip'] }],\n      defaultPath: 'audit-package.zip',\n    });\n    if (result.canceled || !result.filePath) {\n      return null;\n    }\n\n    const where: string[] = [];\n    const params: any[] = [];\n    if (filters.status && filters.status !== 'all') {\n      where.push('status = ?');\n      params.push(filters.status);\n    }\n    if (filters.category && filters.category !== 'all') {\n      where.push('category = ?');\n      params.push(filters.category);\n    }\n    const whereSql = where.length ? `WHERE ${where.join(' AND ')}` : '';\n\n    const evidenceStmt = db.prepare(\n      `SELECT * FROM evidence e JOIN (SELECT version_group_id, MAX(version_number) AS max_version FROM evidence GROUP BY version_group_id) latest ON e.version_group_id = latest.version_group_id AND e.version_number = latest.max_version ${whereSql}`\n    );\n    const items = evidenceStmt.all(...params) as EvidenceRow[];\n\n    const pdfPath = await createReportPdf(items, fontPath, path.dirname(result.filePath));\n\n    await createZipWithPdfAndFiles(result.filePath, pdfPath, items);\n\n    if (items.length > 0) {\n      logAudit('EXPORT_PACKAGE', items[0].id, 'evidence');\n    } else {\n      logAudit('EXPORT_PACKAGE', 'none', 'evidence');\n    }\n\n    return result.filePath;\n  });\n}\n\nfunction upsertTagsForEvidence(evidenceId: string, tags: string[]) {\n  const trimmed = Array.from(\n    new Set(tags.map((t) => t.trim()).filter((t) => t.length > 0))\n  );\n  const insertTag = db.prepare(\n    'INSERT OR IGNORE INTO tags (id, name) VALUES (@id, @name)'\n  );\n  const selectTag = db.prepare('SELECT id FROM tags WHERE name = ?');\n  const insertEvidenceTag = db.prepare(\n    'INSERT OR IGNORE INTO evidence_tags (evidence_id, tag_id) VALUES (?, ?)'\n  );\n  const deleteEvidenceTags = db.prepare(\n    'DELETE FROM evidence_tags WHERE evidence_id = ?'\n  );\n\n  db.transaction(() => {\n    deleteEvidenceTags.run(evidenceId);\n    for (const name of trimmed) {\n      let row = selectTag.get(name) as { id: string } | undefined;\n      if (!row) {\n        const id = crypto.randomUUID();\n        insertTag.run({ id, name });\n        row = { id };\n      }\n      insertEvidenceTag.run(evidenceId, row.id);\n    }\n  })();\n}\n\nfunction logAudit(action: string, entityId: string, entityType: string) {\n  const stmt = db.prepare(\n    `INSERT INTO audit_log (id, action_type, entity_id, entity_type, actor, timestamp)\n     VALUES (@id, @action_type, @entity_id, @entity_type, @actor, @timestamp)`\n  );\n  stmt.run({\n    id: crypto.randomUUID(),\n    action_type: action,\n    entity_id: entityId,\n    entity_type: entityType,\n    actor: 'system',\n    timestamp: new Date().toISOString(),\n  });\n}\n\nfunction createReportPdf(\n  items: EvidenceRow[],\n  fontPath: string,\n  outputDir: string\n): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const doc = new PDFDocument({ margin: 50 });\n    const pdfPath = path.join(outputDir, `report-ukrainian-${Date.now()}.pdf`);\n    const stream = fs.createWriteStream(pdfPath);\n\n    stream.on('close', () => resolve(pdfPath));\n    stream.on('error', (err) => reject(err));\n    doc.on('error', (err) => reject(err));\n\n    doc.pipe(stream);\n\n    try {\n      doc.registerFont('NotoSans', fontPath);\n      doc.font('NotoSans');\n    } catch (err) {\n      reject(\n        new Error(\n          `Failed to register Ukrainian font at ${fontPath}: ${(err as Error).message}`\n        )\n      );\n      doc.end();\n      return;\n    }\n\n    doc.fontSize(18).text('Звіт аудиторського пакету', { align: 'center' });\n    doc.moveDown();\n\n    const formattedDate = new Intl.DateTimeFormat('uk-UA', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n    }).format(new Date());\n\n    doc.fontSize(12).text(`Дата: ${formattedDate}`, { align: 'left' });\n    doc.moveDown();\n\n    doc.fontSize(12).text('Список доказів:', { underline: true });\n    doc.moveDown(0.5);\n\n    const headers = ['Назва', 'Категорія', 'Статус', 'Версія', 'Теги'];\n    doc.text(headers.join(' | '));\n    doc.moveDown(0.5);\n\n    for (const item of items) {\n      const tagsStmt = db.prepare(\n        'SELECT t.name FROM tags t JOIN evidence_tags et ON et.tag_id = t.id WHERE et.evidence_id = ?'\n      );\n      const tags = tagsStmt.all(item.id).map((t: any) => t.name) as string[];\n      const line = [\n        `Назва: ${item.title}`,\n        `Категорія: ${item.category}`,\n        `Статус: ${item.status}`,\n        `Версія: ${item.version_number}`,\n        `Теги: ${tags.join(', ')}`,\n      ].join(' | ');\n      doc.text(line);\n    }\n\n    doc.end();\n  });\n}\n\nfunction createZipWithPdfAndFiles(zipPath: string, pdfPath: string, items: EvidenceRow[]): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const output = fs.createWriteStream(zipPath);\n    const archive = archiver('zip', { zlib: { level: 9 } });\n\n    output.on('close', () => resolve());\n    archive.on('error', (err) => reject(err));\n\n    archive.pipe(output);\n\n    archive.file(pdfPath, { name: 'report-ukrainian.pdf' });\n\n    for (const item of items) {\n      if (fs.existsSync(item.file_path)) {\n        archive.file(item.file_path, { name: path.basename(item.file_path) });\n      }\n    }\n\n    archive.finalize();\n  });\n}\n\napp.whenReady().then(() => {\n  ensureDatabase();\n  registerIpcHandlers();\n  createWindow();\n\n  app.on('activate', () => {\n    if (BrowserWindow.getAllWindows().length === 0) {\n      createWindow();\n    }\n  });\n});\n\napp.on('window-all-closed', () => {\n  if (process.platform !== 'darwin') {\n    app.quit();\n  }\n});\n","import { app } from 'electron';\nimport path from 'path';\nimport fs from 'fs';\n\nexport function resolveFontPath(): string {\n  const candidates: string[] = [];\n\n  const appPath = app.getAppPath();\n  candidates.push(path.join(appPath, 'assets', 'fonts', 'NotoSans-Regular.ttf'));\n\n  if (process.resourcesPath) {\n    candidates.push(\n      path.join(process.resourcesPath, 'assets', 'fonts', 'NotoSans-Regular.ttf')\n    );\n  }\n\n  candidates.push(path.join(__dirname, '..', 'assets', 'fonts', 'NotoSans-Regular.ttf'));\n\n  for (const candidate of candidates) {\n    if (fs.existsSync(candidate)) {\n      return candidate;\n    }\n  }\n\n  const message = `NotoSans-Regular.ttf font not found. Looked in: ${candidates.join(\n    ' , '\n  )}. Ensure assets/fonts/NotoSans-Regular.ttf is bundled with the app.`;\n  throw new Error(message);\n}\n\n"],"mappings":"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","names":["import_electron","import_path","import_fs","path","fs","path","fs","BetterSqlite3","crypto","PDFDocument","archiver"]}